/*
Copyright (c) 2012 jqWidgets.
http://jqwidgets.com/license/
*/

(function(a){a.jqx.jqxWidget("jqxListBox","",{});a.extend(a.jqx._jqxListBox.prototype,{defineInstance:function(){this.disabled=false;this.width=null;this.height=null;this.items=new Array();this.multiple=false;this.selectedIndex=-1;this.selectedIndexes=new Array();this.source=null;this.scrollBarSize=15;this.enableHover=true;this.enableSelection=true;this.visualItems=new Array();this.groups=new Array();this.equalItemsWidth=true;this.itemHeight=-1;this.visibleItems=new Array();this.emptyGroupText="Group";this.checkboxes=false;this.hasThreeStates=false;this.autoHeight=false;this.roundedcorners=true;this.events=["select","unselect","change","checkchange",]},createInstance:function(d){var b=this;this.host.addClass(this.toThemeProperty("jqx-listbox"));this.host.addClass(this.toThemeProperty("jqx-rc-all"));if(this.width!=null&&this.width.toString().indexOf("px")!=-1){this.host.width(this.width)}else{if(this.width!=undefined&&!isNaN(this.width)){this.host.width(this.width)}}if(this.height!=null&&this.height.toString().indexOf("px")!=-1){this.host.height(this.height)}else{if(this.height!=undefined&&!isNaN(this.height)){this.host.height(this.height)}}var e=a("<div tabIndex=0 style='-webkit-appearance: none; background: transparent; outline: none; width:100%; height: 100%; align:left; border: 0px; padding: 0px; margin: 0px; left: 0px; top: 0px; valign:top; position: relative;'><div id='listBoxWrapper' tabIndex=1 style='-webkit-appearance: none; border: none; background: transparent; outline: none; width:100%; height: 100%; padding: 0px; margin: 0px; align:left; left: 0px; top: 0px; valign:top; position: relative;'><div id='listBoxContent' tabIndex=2 style='-webkit-appearance: none; border: none; background: transparent; outline: none; border: none; padding: 0px; overflow: hidden; margin: 0px; align:left; valign:top; left: 0px; top: 0px; position: absolute;'/><div id='verticalScrollBar' style='align:left; valign:top; left: 0px; top: 0px; position: absolute;'/><div id='horizontalScrollBar' style='align:left; valign:top; left: 0px; top: 0px; position: absolute;'/><div id='bottomRight' style='align:left; valign:top; left: 0px; top: 0px; border: none; position: absolute;'/></div></div>");this.host.css("tabIndex",1);this.host.append(e);var g=this.host.find("#verticalScrollBar");this.vScrollBar=g.jqxScrollBar({vertical:true,theme:this.theme,largestep:parseInt(this.host.height())/2});var f=this.host.find("#horizontalScrollBar");this.hScrollBar=f.jqxScrollBar({vertical:false,theme:this.theme});this.content=this.host.find("#listBoxContent");this.bottomRight=this.host.find("#bottomRight").addClass(this.toThemeProperty("jqx-listbox-bottomright"));this.vScrollBar.css("visibility","visible");this.hScrollBar.css("visibility","visible");this.vScrollInstance=a.data(this.vScrollBar[0],"jqxScrollBar").instance;this.hScrollInstance=a.data(this.hScrollBar[0],"jqxScrollBar").instance;var c=a.jqx.mobile.isTouchDevice();if(c){a.jqx.mobile.touchScroll(this.element,b.vScrollInstance.max,function(l,k){if(b.vScrollBar.css("visibility")=="visible"){var h=b.vScrollInstance.value;b.vScrollInstance.setPosition(h+k)}if(b.hScrollBar.css("visibility")=="visible"){var h=b.hScrollInstance.value;b.hScrollInstance.setPosition(h+l)}})}},beginUpdateLayout:function(){this.updating=true},resumeUpdateLayout:function(){this.updating=false;this.vScrollInstance.value=0;this._render(false)},propertyChangedHandler:function(b,c,e,d){if(this.isInitialized==undefined||this.isInitialized==false){return}if(c=="source"||c=="scrollBarSize"||c=="equalItemsWidth"||c=="checkboxes"){b.refresh()}if(this.updating){if(c=="width"||c=="height"){setTimeout(function(){b.vScrollInstance.value=0;b._render(false)},1)}}if(c=="theme"){b.jqxScrollBar({theme:b.theme});b.jqxScrollBar({theme:b.theme})}if(c=="selectedIndex"){b.selectIndex(d,true)}if(c=="autoHeight"){b.refresh()}},loadFromSelect:function(k){if(k==null){return}var c="#"+k;var f=a(c);if(f.length>0){var e=f.find("option");var b=f.find("optgroup");var d=0;var h=-1;var g=new Array();a.each(e,function(){var m=b.find(this).length>0;var o=null;if(this.text!=this.value&&this.label==null){this.label=this.text}var n={disabled:this.disabled,value:this.value,label:this.label,title:this.title,originalItem:this};var l=a.browser.msie&&a.browser.version<8;if(l){if(n.value==""&&this.text!=null&&this.text.length>0){n.value=this.text}}if(m){o=b.find(this).parent()[0].label;n.group=o}if(this.selected){h=d}g[d]=n;d++});this.source=g;this.fromSelect=true;this.clearSelection();this.selectedIndex=h;this.refresh()}},refresh:function(){this.visibleItems=new Array();this.items=this.loadItems(this.source);this._render()},_render:function(b){this._addItems();this._renderItems();if(b==undefined||b){if(this.items!=undefined&&this.items!=null){if(this.selectedIndex>=0&&this.selectedIndex<this.items.length){this.selectIndex(this.selectedIndex);this.ensureVisible(this.selectedIndex)}}}},_createID:function(){var b=Math.random()+"";b=b.replace(".","");b="99"+b;b=b/1;while(this.items[b]){b=Math.random()+"";b=b.replace(".","");b=b/1}return"listitem"+b},_hitTest:function(c,e){var d=parseInt(this.vScrollInstance.value);var b=this._searchFirstVisibleIndex(e+d,this.renderedVisibleItems);if(this.renderedVisibleItems[b]!=undefined&&this.renderedVisibleItems[b].isGroup){return null}b=this._searchFirstVisibleIndex(e+d);return this.visibleItems[b];return null},_searchFirstVisibleIndex:function(e,f){if(e==undefined){e=parseInt(this.vScrollInstance.value)}var c=0;if(f==undefined||f==null){f=this.visibleItems}var b=f.length;while(c<=b){mid=parseInt((c+b)/2);var d=f[mid];if(d==undefined){break}if(d.initialTop>e&&d.initialTop+d.height>e){b=mid-1}else{if(d.initialTop<e&&d.initialTop+d.height<e){c=mid+1}else{return mid;break}}}return 0},_renderItems:function(){if(this.items==undefined||this.items.length==0){return}var o=this.vScrollInstance;var z=this.hScrollInstance;var u=parseInt(o.value);var f=parseInt(z.value);var H=this.items.length;var A=parseInt(this.content.width())+parseInt(z.max);var d=parseInt(this.vScrollBar.outerWidth());if(this.vScrollBar.css("visibility")!="visible"){d=0}if(this.hScrollBar.css("visibility")!="visible"){A=parseInt(this.content.width())}var h=this._getVirtualItemsCount();var J=new Array();var n=0;var m=this.host.outerHeight();var E=0;var k=0;var b=0;if(o.value==0||this.visibleItems.length==0){for(i=0;i<this.items.length;i++){var I=this.items[i];if(I.visible){I.top=-u;I.initialTop=-u;if(!I.isGroup&&I.visible){this.visibleItems[k++]=I;I.visibleIndex=k-1}this.renderedVisibleItems[b++]=I;I.left=-f;var l=I.top+I.height;if(l>=0&&I.top-I.height<=m){J[n++]={index:i,item:I}}u-=I.height}}}var c=u>0?this._searchFirstVisibleIndex(this.vScrollInstance.value,this.renderedVisibleItems):0;var B=0;n=0;var q=this.vScrollInstance.value;var C=0;while(B<100+m){var I=this.renderedVisibleItems[c];if(I==undefined){break}if(I.visible){I.left=-f;var l=I.top+I.height-q;if(l>=0&&I.initialTop-q-I.height<=2*m){J[n++]={index:c,item:I}}}c++;if(I.visible){B+=I.initialTop-q+I.height-B}C++;if(C>this.items.length-1){break}}var L=this.toThemeProperty("jqx-listitem-state-normal");var t=this.toThemeProperty("jqx-listitem-state-group");var x=this.toThemeProperty("jqx-listitem-state-disabled");var K=0;var w=this.host.height();var G=a("<span></span>");G.appendTo(a(document.body));for(i=0;i<this.visualItems.length;i++){var F=this.visualItems[i];var D=function(){var y=F.find("#spanElement");y.css({visibility:"hidden"});y.removeClass();if(this.checkboxes&&this.host.jqxCheckBox){var M=F.find("chkbox");M.css({visibility:"hidden"})}};if(i<J.length){var I=J[i].item;if(I.initialTop-q>=w){D();continue}var v=F.find("#spanElement");if(v.length==0){continue}v.removeClass();v.css({display:"block",visibility:"visible"});if(!I.isGroup&&!this.selectedIndexes[I.index]>=0){v.addClass(L)}else{v.addClass(t)}if(I.disabled||this.disabled){v.addClass(x)}if(this.roundedcorners){v.addClass(this.toThemeProperty("jqx-rc-all"))}if(I.html!=null&&I.html.toString().length>0){G[0].innerHTML=I.html;if(G[0].innerHTML!=v[0].innerHTML){v[0].innerHTML=I.html}}else{if(I.label!=null||I.value!=null){if(I.label!=null){if(v[0].innerHTML!=I.label){v[0].innerHTML=I.label}}else{if(v[0].innerHTML!=I.value){v[0].innerHTML=I.value}}}}if(i==0){this.itemswrapper.css("left",I.left)}F[0].style.top=I.initialTop-q+"px";I.element=v[0];a.data(v[0],"item",I);if(I.title){v[0].title=I.title}if(this.equalItemsWidth&&!I.isGroup){if(E==0){var e=parseInt(A);var r=parseInt(v.outerWidth())-parseInt(v.width());e-=r;var p=1;if(p!=null){p=parseInt(p)}else{p=0}e-=2*p;E=e;if(this.checkboxes&&this.host.jqxCheckBox){E-=18}}v.width(E);I.width=E}if(this.checkboxes&&this.host.jqxCheckBox&&!I.isGroup){if(K==0){K=(parseInt(F.outerHeight(true))-16)/2;K++}var s=a(F.children()[0]);s[0].item=I;v.css({left:"18px"});s.css("top",K+"px");s.css({display:"block",visibility:"visible"});var g=s.jqxCheckBox("checked");if(g!=I.checked){s.jqxCheckBox({checked:I.checked,disabled:I.disabled})}}if(this.selectedIndexes[I.visibleIndex]>=0&&!I.disabled){v.addClass(this.toThemeProperty("jqx-listitem-state-selected"))}}else{D()}}G.remove()},_calculateVirtualSize:function(){var d=0;var k=2;var g=0;var f=a("<span></span>");var e=0;var c=this.host.outerHeight();a(document.body).append(f);for(g=0;g<this.items.length;g++){var l=this.items[g];if(l.isGroup&&(l.label==""&&l.html=="")){continue}if(!l.visible){continue}if(this.itemHeight>-1){l.height=this.itemHeight;l.width=this.content.width();k+=this.itemHeight}else{if(!l.isGroup){f.addClass(this.toThemeProperty("jqx-listitem-state-normal jqx-rc-all"))}else{f.addClass(this.toThemeProperty("jqx-listitem-state-group jqx-rc-all"))}if(this.equalItemsWidth){f.css("float","left")}if(l.html!=null&&l.html.toString().length>0){f.html(l.html)}else{if(l.label!=null||l.value!=null){if(l.label!=null){f.text(l.label)}else{f.text(l.value)}}}var b=f.outerHeight();var h=f.outerWidth();l.height=b;l.width=h;k+=b;d=Math.max(d,h)}if(k<=c){e++}}if(e<10){e=10}f.remove();return{width:d,height:k,itemsPerPage:e}},_getVirtualItemsCount:function(){if(this.virtualItemsCount==0){var b=parseInt(this.host.height())/5;if(b>this.items.length){b=this.items.length}return b}else{return this.virtualItemsCount}},_addItems:function(){if(this.items==undefined||this.items.length==0){return}var q=this;var l=0;this.visibleItems=new Array();this.renderedVisibleItems=new Array();this.content.find(".jqx-listitem-state-normal").remove();this.content.find(".jqx-listitem-state-pressed").remove();this.content.find(".jqx-listitem-state-hover").remove();this.content.find(".jqx-listitem-state-disabled").remove();this.content.find(".jqx-listitem-state-group ").remove();this._removeHandlers();this.content[0].innerHTML="";this.itemswrapper=a('<div style="overflow:hidden; width:100%; position: relative;"></div>');this.itemswrapper.height(2*this.host.height());this.content.append(this.itemswrapper);var m=this._calculateVirtualSize();var n=m.itemsPerPage*2;if(this.autoHeight){n=this.items.length}this.virtualItemsCount=Math.min(n,this.items.length);var k=this;var h=m.width;this.virtualSize=m;this.itemswrapper.width(Math.max(this.host.width(),17+m.width));for(virtualItemIndex=0;virtualItemIndex<this.virtualItemsCount;virtualItemIndex++){var p=this.items[virtualItemIndex];var b=a("<div style='border: none; tabIndex=0 width:100%; height: 100%; align:left; valign:top; position: absolute;'></div>");var d=a("<span id='spanElement'></span>");b[0].id=q._createID();d.appendTo(b);b.appendTo(this.itemswrapper);if(this.checkboxes&&this.host.jqxCheckBox){var g=a('<div tabIndex=1 style="background-color: transparent; padding: 0; margin: 0; position: absolute; float: left; width: 16px; height: 16px;" class="chkbox"/>');b.css("float","left");d.css("float","left");b.prepend(g);g.jqxCheckBox({checked:p.checked,animationShowDelay:0,animationHideDelay:0,disabled:p.disabled,hasThreeStates:this.hasThreeStates,theme:this.theme});p.checkBoxElement=g[0];this.addHandler(g,"change",function(t){var r=t.owner.element.item;if(r!=null){var s=t.args;if(s.checked){k.checkIndex(r.index,false)}else{if(s.checked==false){k.uncheckIndex(r.index,false)}else{k.indeterminate(r.index,false)}}}k.focused=true})}b.height(p.height);b.css("top",l);l+=p.height;this.visualItems[virtualItemIndex]=b}this._addHandlers();this._arrange();var o=m.height;var f=this.vScrollInstance;var e=this.hScrollInstance;if(o>this.host.outerHeight()){var c=0;if(h>this.host.outerWidth()){c=this.hScrollBar.outerHeight()+2}f.max=2+parseInt(o)+c-parseInt(this.host.height());this.vScrollBar.css("visibility","visible")}else{this.vScrollBar.css("visibility","hidden")}if(h>this.host.outerWidth()){e.max=parseInt(h)-parseInt(this.content.width())+parseInt(this.hScrollBar.height());this.hScrollBar.css("visibility","visible")}else{this.hScrollBar.css("visibility","hidden")}this._arrange()},clearSelection:function(b){for(i=0;i<this.selectedIndexes.length;i++){this.selectedIndexes[i]=-1}this.selectedIndex=-1;if(b==undefined||b==true){this._renderItems()}},unselectIndex:function(b,c){if(isNaN(b)){return}this.selectedIndexes[i]=-1;if(c==undefined||c==true){this._renderItems();this._raiseEvent("1",{index:b,type:type})}this._raiseEvent("2",{index:b,item:this.getItem(b)})},getItem:function(c){if(c==-1||isNaN(c)){return null}var b=null;var d=a.each(this.items,function(){if(this.index==c){b=this;return false}});return b},checkIndex:function(b,c){if(!this.checkboxes||!this.host.jqxCheckBox){return}if(isNaN(b)){return}if(b<0||b>=this.visibleItems.length){return}if(this.visibleItems[b]!=null&&this.visibleItems[b].disabled){return}if(this.disabled){return}var d=this.getItem(b);if(d!=null){var e=a(d.checkBoxElement);d.checked=true;if(c==undefined||c==true){this._renderItems()}}this._raiseEvent(3,{checked:true})},uncheckIndex:function(b,c){if(!this.checkboxes||!this.host.jqxCheckBox){return}if(isNaN(b)){return}if(b<0||b>=this.visibleItems.length){return}if(this.visibleItems[b]!=null&&this.visibleItems[b].disabled){return}if(this.disabled){return}var d=this.getItem(b);if(d!=null){var e=a(d.checkBoxElement);d.checked=false;if(c==undefined||c==true){this._renderItems()}}this._raiseEvent(3,{checked:false})},indeterminateIndex:function(b,c){if(!this.checkboxes||!this.host.jqxCheckBox){return}if(isNaN(b)){return}if(b<0||b>=this.visibleItems.length){return}if(this.visibleItems[b]!=null&&this.visibleItems[b].disabled){return}if(this.disabled){return}var d=this.getItem(b);if(d!=null){var e=a(d.checkBoxElement);d.checked=null;if(c==undefined||c==true){this._renderItems()}}this._raiseEvent(3,{checked:null})},getSelectedIndex:function(){return this.selectedIndex},getSelectedItem:function(){return this.getItem(this.selectedIndex)},selectIndex:function(c,e,g,d,f){if(isNaN(c)){return}if(c<-1||c>=this.visibleItems.length){return}if(this.visibleItems[c]!=null&&this.visibleItems[c].disabled){return}if(this.disabled){return}if(!this.multiple&&this.selectedIndex==c){return}this.focused=true;var b=false;if(this.selectedIndex!=c){b=true}var h=this.selectedIndex;if(this.selectedIndex==c&&!this.multiple){h=-1}if(f==undefined){f="none"}if(d!=undefined&&d){this._raiseEvent("1",{index:h,type:f});this.selectedIndex=c;this.selectedIndexes[h]=-1;this.selectedIndexes[c]=c;this._raiseEvent("0",{index:c,type:f})}else{if(this.multiple){if(this.selectedIndexes[c]==undefined||this.selectedIndexes[c]==-1){this.selectedIndexes[c]=c;this.selectedIndex=c;this._raiseEvent("0",{index:c,type:f})}else{h=this.selectedIndexes[c];this.selectedIndexes[c]=-1;this.selectedIndex=-1;this._raiseEvent("1",{index:h,type:f})}}else{this._raiseEvent("1",{index:h,type:f});this.selectedIndex=c;this.selectedIndexes[h]=-1;h=c;this.selectedIndexes[c]=c;this._raiseEvent("0",{index:c,type:f})}}if(g==undefined||g==true){this._renderItems()}if(e!=undefined&&e!=null&&e==true){this.ensureVisible(c)}this._raiseEvent("2",{index:c,item:this.getItem(c)});return b},isIndexInView:function(c){if(isNaN(c)){return false}if(c<0||c>=this.items.length){return false}var d=this.vScrollInstance.value;var b=this.visibleItems[this.selectedIndex].initialTop;if(b-d<0||b-d>=this.host.outerHeight()){return false}return true},_itemsInPage:function(){var b=0;var c=this;a.each(this.items,function(){if((this.initialTop+this.height)>=c.content.height()){return false}b++});return b},_firstItemIndex:function(){if(this.visibleItems!=null){if(this.visibleItems[0].isGroup){return this._nextItemIndex(0)}else{return 0}}return -1},_lastItemIndex:function(){if(this.visibleItems!=null){if(this.visibleItems[this.visibleItems.length-1].isGroup){return this._prevItemIndex(this.visibleItems.length-1)}else{return this.visibleItems.length-1}}return -1},_nextItemIndex:function(b){for(i=b+1;i<this.visibleItems.length;i++){if(!this.visibleItems[i].disabled&&!this.visibleItems[i].isGroup){return i}}return -1},_prevItemIndex:function(b){for(i=b-1;i>=0;i--){if(!this.visibleItems[i].disabled&&!this.visibleItems[i].isGroup){return i}}return -1},_handleKeyDown:function(b){var l=b.keyCode;var m=this;var g=m.selectedIndex;var c=m.selectedIndex;var h=false;if(b.altKey){l=-1}if(l==33){var f=m._itemsInPage();if(m.selectedIndex-f>=0){if(m.multiple){m.clearSelection(false)}m.selectIndex(c-f,false,false,false,"keyboard")}else{if(m.multiple){m.clearSelection(false)}m.selectIndex(m._firstItemIndex(),false,false,false,"keyboard")}}if(l==32&&this.checkboxes){var e=this.getItem(g);if(e!=null){if(e.checked==true){e.checked=this.hasThreeStates?null:false}else{e.checked=e.checked!=null}switch(e.checked){case true:this.checkIndex(g);break;case false:this.uncheckIndex(g);break;default:this.indeterminateIndex(g);break}}}if(l==36){if(m.multiple){m.clearSelection(false)}m.selectIndex(m._firstItemIndex(),false,false,false,"keyboard")}if(l==35){if(m.multiple){m.clearSelection(false)}m.selectIndex(m._lastItemIndex(),false,false,false,"keyboard")}if(l==34){var f=m._itemsInPage();if(m.selectedIndex+f<m.visibleItems.length){if(m.multiple){m.clearSelection(false)}m.selectIndex(c+f,false,false,false,"keyboard")}else{if(m.multiple){m.clearSelection(false)}m.selectIndex(m._lastItemIndex(),false,false,false,"keyboard")}}if(l==38){if(m.selectedIndex>0){var k=m._prevItemIndex(m.selectedIndex);if(k!=m.selectedIndex&&k!=-1){if(m.multiple){m.clearSelection(false)}m.selectIndex(k,false,false,false,"keyboard")}else{return true}}else{return false}}else{if(l==40){if(m.selectedIndex+1<m.visibleItems.length){var k=m._nextItemIndex(m.selectedIndex);if(k!=m.selectedIndex&&k!=-1){if(m.multiple){m.clearSelection(false)}m.selectIndex(k,false,false,false,"keyboard")}else{return true}}else{return false}}}if(l==35||l==36||l==38||l==40||l==34||l==33){var d=m.isIndexInView(m.selectedIndex);if(!d){m.ensureVisible(m.selectedIndex)}else{m._renderItems()}return false}return true},wheel:function(d,c){var e=0;if(!d){d=window.event}if(d.originalEvent&&d.originalEvent.wheelDelta){d.wheelDelta=d.originalEvent.wheelDelta}if(d.wheelDelta){e=d.wheelDelta/120}else{if(d.detail){e=-d.detail/3}}if(e){var b=c._handleDelta(e);if(!b){if(d.preventDefault){d.preventDefault()}return b}else{return}}if(d.preventDefault){d.preventDefault()}d.returnValue=false},_handleDelta:function(d){if(this.focused){var c=this.vScrollInstance.value;if(d<0){this.scrollDown()}else{this.scrollUp()}var b=this.vScrollInstance.value;if(c!=b){return false}}return true},_removeHandlers:function(){var b=this;this.removeHandler(this.vScrollBar,"valuechanged");this.removeHandler(this.hScrollBar,"valuechanged");this.removeHandler(this.host,"mousewheel");this.removeHandler(this.content,"keydown");this.removeHandler(this.content,"mouseleave");this.removeHandler(this.content,"focus");this.removeHandler(this.content,"blur");this.removeHandler(this.content,"mouseenter");this.removeHandler(this.content,"mouseup");this.removeHandler(this.content,"mousedown");this.removeHandler(this.content,"mousemove");if(a.browser.msie){this.removeHandler(this.content,"selectstart")}},_addHandlers:function(){var c=this;this.focused=false;var b=false;var h=0;var e=null;var h=0;var g=0;var f=new Date();var d=a.jqx.mobile.isTouchDevice();this.addHandler(this.vScrollBar,"valuechanged",function(k){c._renderItems()});this.addHandler(this.hScrollBar,"valuechanged",function(){c._renderItems()});this.addHandler(this.host,"mousewheel",function(k){c.wheel(k,c)});this.addHandler(this.content,"keydown",function(k){if(c.focused){return c._handleKeyDown(k)}});this.addHandler(this.content,"mouseleave",function(k){c.focused=false;var l=a.data(c.element,"hoveredItem");if(l!=null){a(l).removeClass(c.toThemeProperty("jqx-listitem-state-hover"))}});this.addHandler(this.content,"focus",function(k){c.focused=true});this.addHandler(this.content,"blur",function(k){c.focused=false});this.addHandler(this.content,"mouseenter",function(k){c.focused=true});if(this.enableSelection){this.addHandler(this.content,"mousedown",function(n){if(n.target.id!="listBoxContent"&&c.itemswrapper[0]!=n.target){c.focused=true;c.content.focus();var o=n.target;var p=a(o).offset();var l=c.host.offset();var q=parseInt(p.top)-parseInt(l.top);var k=parseInt(p.left)-parseInt(l.left);var m=c._hitTest(k,q);if(m!=null&&!m.isGroup){if(m.html.indexOf("href")!=-1){setTimeout(function(){c.selectIndex(m.visibleIndex,false,true,false,"mouse")},100)}else{c.selectIndex(m.visibleIndex,false,true,false,"mouse")}}}return false});this.addHandler(this.content,"mouseup",function(k){c.vScrollInstance.handlemouseup(c,k)});if(a.browser.msie){this.addHandler(this.content,"selectstart",function(k){return false})}}var d=a.jqx.mobile.isTouchDevice();if(this.enableHover&&!d){this.addHandler(this.content,"mousemove",function(k){if(!c.enableHover){return true}var l=a.browser.msie==true&&a.browser.version<9?0:1;if(k.target==null){return true}if(c.disabled){return true}c.focused=true;var n=c.vScrollInstance.isScrolling();if(!n&&k.target.id!="listBoxContent"){if(c.itemswrapper[0]!=k.target){var p=k.target;var u=a(p).offset();var o=c.host.offset();var q=parseInt(u.top)-parseInt(o.top);var r=parseInt(u.left)-parseInt(o.left);var t=c._hitTest(r,q);if(t!=null&&!t.isGroup&&!t.disabled){var m=a.data(c.element,"hoveredItem");if(m!=null){a(m).removeClass(c.toThemeProperty("jqx-listitem-state-hover"))}a.data(c.element,"hoveredItem",t.element);var s=a(t.element);s.addClass(c.toThemeProperty("jqx-listitem-state-hover"))}}}})}},_arrange:function(){var c=null;var k=null;if(this.width!=null&&this.width.toString().indexOf("px")!=-1){c=this.width}else{if(this.width!=undefined&&!isNaN(this.width)){c=this.width}}if(this.height!=null&&this.height.toString().indexOf("px")!=-1){k=this.height}else{if(this.height!=undefined&&!isNaN(this.height)){k=this.height}}var h=this.host.css("border-width");if(h==null){h=0}if(c!=null){c=parseInt(c);this.host.width(this.width)}if(!this.autoHeight){if(k!=null){k=parseInt(k);this.host.height(this.height)}}else{this.host.height(this.virtualSize.height);this.height=this.virtualSize.height}var b=this.scrollBarSize;if(isNaN(b)){b=parseInt(b);if(isNaN(b)){b="17px"}else{b=b+"px"}}b=parseInt(b);var f=4;var l=2;var g=0;if(this.vScrollBar.css("visibility")=="visible"){g=b+f}if(this.hScrollBar.css("visibility")=="visible"){l=b+f}this.hScrollBar.height(b);this.hScrollBar.css({top:k-f-b+"px",left:"0px"});this.hScrollBar.width(c-b-f+"px");if(g==0){this.hScrollBar.width(c-2)}this.vScrollBar.width(b);this.vScrollBar.height(parseInt(k)-l+"px");this.vScrollBar.css({left:parseInt(c)-parseInt(b)-f+"px",top:"0px"});var e=this.vScrollInstance;e.disabled=this.disabled;e.refresh();var d=this.hScrollInstance;d.disabled=this.disabled;d.refresh();if((this.vScrollBar.css("visibility")=="visible")&&(this.hScrollBar.css("visibility")=="visible")){this.bottomRight.css("visibility","visible");this.bottomRight.css({left:1+parseInt(this.vScrollBar.css("left")),top:1+parseInt(this.hScrollBar.css("top"))});this.bottomRight.width(parseInt(b)+3);this.bottomRight.height(parseInt(b)+3)}else{this.bottomRight.css("visibility","hidden")}this.content.width(c-g);this.content.height(k-l)},ensureVisible:function(c){if(c<0){return}for(i=0;i<this.visibleItems.length;i++){var d=this.visibleItems[i];if(d.visibleIndex==c&&!d.isGroup){var b=a.data(this.vScrollBar[0],"jqxScrollBar").instance;b.setPosition(d.initialTop);break}}this._renderItems()},scrollDown:function(){if(this.vScrollBar.css("visibility")=="hidden"){return}var b=this.vScrollInstance;if(b.value+b.largestep<=b.max){b.setPosition(b.value+b.largestep)}else{b.setPosition(b.max)}},scrollUp:function(){if(this.vScrollBar.css("visibility")=="hidden"){return}var b=this.vScrollInstance;if(b.value-b.largestep>=b.min){b.setPosition(b.value-b.largestep)}else{b.setPosition(b.min)}},loadItems:function(h){if(h==null){return}var o=this;var f=0;var d=0;var b=0;this.groups=new Array();this.items=new Array();this.visualItems=new Array();var e=new Array();a.map(h,function(t){if(t==undefined){return null}var q=new a.jqx._jqxListBox.item();var u=t.group;var p=t.groupHtml;var v=t.title;if(v==null||v==undefined){v=""}if(u==null||u==undefined){u=""}if(p==null||p==undefined){p=""}if(!o.groups[u]){o.groups[u]={items:new Array(),index:-1,caption:u,captionHtml:p};f++;var r=f+"jqxGroup";o.groups[r]=o.groups[u];d++}var s=o.groups[u];s.index++;s.items[s.index]=q;if(typeof t==="string"){q.label=t;q.value=t}else{if(t.label==null&&t.value==null&&t.html==null&&t.group==null&&t.groupHtml==null){q.label=t.toString();q.value=t.toString()}else{q.label=t.label||t.value;q.value=t.value||t.label}}q.originalItem=t;q.title=v;q.html=t.html||"";q.group=u;q.groupHtml=t.groupHtml||"";q.disabled=t.disabled||false;q.visible=t.visible||true;q.index=b;e[b]=q;b++;return q});var c=new Array();var l=0;if(this.fromSelect==undefined||this.fromSelect==false){for(i=0;i<d;i++){var f=i+1;var k=f+"jqxGroup";var m=this.groups[k];if(m==undefined||m==null){break}if(i==0&&m.caption==""&&m.captionHtml==""&&d<=1){return m.items}else{var g=new a.jqx._jqxListBox.item();g.isGroup=true;g.label=m.caption;if(m.caption==""&&m.captionHtml==""){m.caption=this.emptyGroupText;g.label=m.caption}g.html=m.captionHtml;c[l]=g;l++}for(j=0;j<m.items.length;j++){c[l]=m.items[j];l++}}}else{var l=0;var n=new Array();a.each(e,function(){if(!n[this.group]){if(this.group!=""){var p=new a.jqx._jqxListBox.item();p.isGroup=true;p.label=this.group;c[l]=p;l++;n[this.group]=true}}c[l]=this;l++})}return c},_mapItem:function(c){var b=new a.jqx._jqxListBox.item();if(typeof c==="string"){b.label=c;b.value=c}else{b.label=c.label||c.value;b.value=c.value||c.label}b.html=c.html||"";b.group=c.group||"";b.groupHtml=c.groupHtml||"";b.disabled=c.disabled||false;b.visible=c.visible||true;return b},insertAt:function(k,e){if(k==null){return}var d=this._mapItem(k);if(e==-1||e==undefined||e==null){d.index=this.items.length;this.items[this.items.length]=d}else{var f=new Array();var h=0;var g=false;var b=0;for(itemIndex=0;itemIndex<this.items.length;itemIndex++){if(this.items[itemIndex].isGroup==false){if(b>=e&&!g){f[h++]=d;d.index=e;b++;g=true}}f[h]=this.items[itemIndex];if(!this.items[itemIndex].isGroup){f[h].index=b;b++}h++}this.items=f}this.visibleItems=new Array();var c=a.data(this.vScrollBar[0],"jqxScrollBar").instance;c.setPosition(0);this._addItems();this._renderItems()},removeAt:function(d){if(d<0||d>this.items.length-1){return}var e=new Array();var g=0;var f=false;var b=0;for(itemIndex=0;itemIndex<this.items.length;itemIndex++){if(this.items[itemIndex].isGroup==false){if(b>=d&&!f){f=true;continue}}e[g]=this.items[itemIndex];if(!this.items[itemIndex].isGroup){e[g].index=b;b++}g++}this.items=e;var c=a.data(this.vScrollBar[0],"jqxScrollBar").instance;c.setPosition(0);this.visibleItems=new Array();this._addItems();this._renderItems()},disableAt:function(b){if(b<0||b>this.items.length-1){return}this.items[b].disabled=true;this._renderItems()},enableAt:function(b){if(b<0||b>this.items.length-1){return}this.items[b].disabled=false;this._renderItems()},destroy:function(){this.host.removeClass("jqx-listbox jqx-rc-all")},_raiseEvent:function(f,c){if(c==undefined){c={owner:null}}var d=this.events[f];args=c;args.owner=this;var e=new jQuery.Event(d);e.owner=this;if(f==0||f==1||f==2||f==3){e.args=args}var b=this.host.trigger(e);return b}})})(jQuery);(function(a){a.jqx._jqxListBox.item=function(){var b={group:"",groupHtml:"",selected:false,isGroup:false,highlighted:false,value:null,label:"",html:null,visible:true,disabled:false,element:null,width:null,height:null,initialTop:null,top:null,left:null,title:"",index:-1,checkBoxElement:null,originalItem:null,checked:false,visibleIndex:-1};return b}})(jQuery);