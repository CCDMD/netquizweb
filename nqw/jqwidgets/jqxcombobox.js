/*
Copyright (c) 2012 jqWidgets.
http://jqwidgets.com/license/
*/

(function(a){a.jqx.jqxWidget("jqxComboBox","",{});a.extend(a.jqx._jqxComboBox.prototype,{defineInstance:function(){this.disabled=false;this.width=null;this.height=null;this.items=new Array();this.selectedIndex=-1;this.source=null;this.scrollBarSize=15;this.arrowSize=18;this.enableHover=true;this.enableSelection=true;this.visualItems=new Array();this.groups=new Array();this.equalItemsWidth=true;this.itemHeight=-1;this.visibleItems=new Array();this.emptyGroupText="Group";if(this.showDelay==undefined){this.showDelay=350}if(this.hideDelay==undefined){this.hideDelay=400}this.animationType="default";this.dropDownWidth="auto";this.dropDownHeight="200px";this.enableBrowserBoundsDetection=false;this.searchmode="startswithignorecase";this.autocomplete=false;this.events=["open","close","select","unselect","change"]},createInstance:function(h){this._setSize();var d=a("<div tabIndex=0 style='background-color: transparent; -webkit-appearance: none; outline: none; width:100%; height: 100%; padding: 0px; margin: 0px; border: 0px; position: relative;'><div id='dropdownlistWrapper' style='padding: 0; margin: 0; border: none; background-color: transparent; float: left; width:100%; height: 100%; position: relative;'><div id='dropdownlistContent' style='padding: 0; margin: 0; border: none; float: left; position: relative;'/><div id='dropdownlistArrow' style='padding: 0; margin: 0; border-left-width: 1px; border-bottom-width: 0px; border-top-width: 0px; border-right-width: 0px; background-color: transparent; float: right; position: relative;'/></div></div>");if(a.jqx._jqxListBox==null||a.jqx._jqxListBox==undefined){throw"jqxListBox is not loaded."}try{var j="listBox"+this.element.id;var f=a(a.find("#"+j));if(f.length>0){f.remove()}var b=a("<div style='overflow: hidden; border: none; background-color: transparent; position: absolute;' id='listBox"+this.element.id+"'><div id='innerListBox"+this.element.id+"'></div></div>");b.appendTo(document.body);this.container=b;this.listBoxContainer=a(a.find("#innerListBox"+this.element.id));var c=this.width;if(this.dropDownWidth!="auto"){c=this.dropDownWidth}if(this.dropDownHeight==null){this.dropDownHeight=200}this.listBoxContainer.jqxListBox({width:c,scrollBarSize:this.scrollBarSize,height:this.dropDownHeight,source:this.source,theme:this.theme});this.container.width(parseInt(c)+25);this.container.height(parseInt(this.dropDownHeight)+25);this.listBoxContainer.css({position:"absolute",zIndex:100000,top:0,left:0});this.listBoxContainer.css("border-top-width","1px");this.listBox=a.data(this.listBoxContainer[0],"jqxListBox").instance;this.listBox.enableSelection=this.enableSelection;this.listBox.enableHover=this.enableHover;this.listBox.equalItemsWidth=this.equalItemsWidth;this.listBox.selectIndex(this.selectedIndex);this.listBox._arrange();var i=this;this.addHandler(this.listBoxContainer,"select",function(e){i._raiseEvent("2",{index:e.args.index,type:e.args.type})});this.addHandler(this.listBoxContainer,"unselect",function(e){i._raiseEvent("3",{index:e.args.index,type:e.args.type})});this.addHandler(this.listBoxContainer,"change",function(e){i._raiseEvent("4",{index:e.args.index,type:e.args.type})});if(this.animationType=="none"){this.container.css("display","none")}else{this.container.hide()}}catch(g){}this.touch=a.jqx.mobile.isTouchDevice();this.host.append(d);this.dropdownlistWrapper=this.host.find("#dropdownlistWrapper");this.dropdownlistArrow=this.host.find("#dropdownlistArrow");this.dropdownlistContent=this.host.find("#dropdownlistContent");this.dropdownlistContent.addClass(this.toThemeProperty("jqx-combobox-content"));this.dropdownlistContent.append(a('<input style="margin: 0; padding: 0; border: 0;" type="textarea"/>'));this.input=this.dropdownlistContent.find("input");this.input.addClass(this.toThemeProperty("jqx-combobox-input"));var k=this;k.input.attr("disabled",k.disabled);this.propertyChangeMap.disabled=function(e,m,l,n){if(k.disabled){k.host.addClass(k.toThemeProperty("jqx-combobox-state-disabled"));k.dropdownlistContent.addClass(k.toThemeProperty("jqx-combobox-content-disabled"))}else{k.host.removeClass(k.toThemeProperty("jqx-combobox-state-disabled"));k.dropdownlistContent.removeClass(k.toThemeProperty("jqx-combobox-content-disabled"))}k.input.attr("disabled",k.disabled)};if(this.disabled){this.host.addClass(this.toThemeProperty("jqx-combobox-state-disabled"));this.dropdownlistContent.addClass(this.toThemeProperty("jqx-combobox-content-disabled"))}this.host.addClass(this.toThemeProperty("jqx-combobox-state-normal"));this.host.addClass(this.toThemeProperty("jqx-rc-all"));this.dropdownlistArrow.addClass(this.toThemeProperty("icon-arrow-down"));this.dropdownlistArrow.addClass(this.toThemeProperty("jqx-combobox-arrow-normal"));this.render();this.addHandler(this.input,"keyup.textchange",function(e){var l=i._search(e)})},_search:function(d){if(this.searchmode=="none"||this.searchmode==null||this.searchmode=="undefined"){return}if(d.keyCode==16||d.keyCode==17||d.keyCode==20){return false}if(d.altKey&&d.keyCode==38){this.hideListBox();return false}if(d.altKey&&d.keyCode==40){if(!this.isOpened()){this.showListBox()}return false}if(d.keyCode==37||d.keyCode==39){return false}if(d.altKey){return}if(d.keyCode>=33&&d.keyCode<=40){return}var f=this.input.val();if(f.length==0&&!this.autocomplete){this.hideListBox();this.listBox.selectIndex(-1,true);return}var c=this;var e=this._getMatches(f);var h=e.matchItems;var b=e.index;if(c.autocomplete){if(h.length>0||f==""){this.listBox.vScrollInstance.value=0;this.listBox._addItems();this.listBox.autoHeight=false;if(this.listBox.virtualSize.height<parseInt(this.dropDownHeight)){this.listBox.autoHeight=true;this.container.height(this.listBox.virtualSize.height+25);this.listBoxContainer.height(this.listBox.virtualSize.height);this.listBox._arrange()}else{this.listBox.height=this.dropDownHeight;this.container.height(parseInt(this.dropDownHeight)+25);this.listBoxContainer.height(parseInt(this.dropDownHeight));this.listBox._arrange()}this.listBox._addItems();this.listBox._renderItems();b=0}else{b=-1}if(b==-1){this.hideListBox()}}if(d.keyCode=="13"){this.listBox.selectIndex(b,true);this.hideListBox();this.renderSelection("mouse")}else{if(d.keyCode=="27"){if(a.data(document.body,"this.listBox.selectedIndex")!=null){var g=a.data(document.body,"this.listBox.selectedIndex");this.listBox.selectIndex(g,true);this.renderSelection("mouse")}this.hideListBox()}else{if(b>-1){if(!this.isOpened()){a.data(document.body,"this.listBox.selectedIndex",this.listBox.selectedIndex);this.showListBox()}this.listBox.selectIndex(b,true)}else{if(b==-1){this.listBox.selectIndex(b,true)}}}}},_getMatches:function(f){var b=this.getItems();var e=this;var c=-1;var g=new Array();var d=0;a.each(b,function(h){var k="";if(!this.isGroup){if(this.label){k=this.label}else{if(this.value){k=this.value}else{if(this.title){k=this.title}else{k="jqxItem"}}}var j=false;switch(e.searchmode){case"containsignorecase":j=a.jqx.string.containsIgnoreCase(k,f);break;case"contains":j=a.jqx.string.contains(k,f);break;case"equals":j=a.jqx.string.equals(k,f);break;case"equalsignorecase":j=a.jqx.string.equalsIgnoreCase(k,f);break;case"startswith":j=a.jqx.string.startsWith(k,f);break;case"startswithignorecase":j=a.jqx.string.startsWithIgnoreCase(k,f);break;case"endswith":j=a.jqx.string.endsWith(k,f);break;case"endswithignorecase":j=a.jqx.string.endsWithIgnoreCase(k,f);break}if(e.autocomplete&&!j){this.visible=false}if(j&&e.autocomplete){g[d++]=this;this.visible=true}if(f==""&&e.autocomplete){this.visible=true;j=false}if(j&&!e.autocomplete){c=this.visibleIndex;return false}}});return{index:c,matchItems:g}},findItems:function(e){var b=this.getItems();var d=this;var c=0;var f=new Array();a.each(b,function(g){var j="";if(!this.isGroup){if(this.label){j=this.label}else{if(this.value){j=this.value}else{if(this.title){j=this.title}else{j="jqxItem"}}}var h=false;switch(d.searchmode){case"containsignorecase":h=a.jqx.string.containsIgnoreCase(j,e);break;case"contains":h=a.jqx.string.contains(j,e);break;case"equals":h=a.jqx.string.equals(j,e);break;case"equalsignorecase":h=a.jqx.string.equalsIgnoreCase(j,e);break;case"startswith":h=a.jqx.string.startsWith(j,e);break;case"startswithignorecase":h=a.jqx.string.startsWithIgnoreCase(j,e);break;case"endswith":h=a.jqx.string.endsWith(j,e);break;case"endswithignorecase":h=a.jqx.string.endsWithIgnoreCase(j,e);break}if(h){f[c++]=this}}});return f},_resetautocomplete:function(){a.each(this.listBox.items,function(b){this.visible=true});this.listBox.vScrollInstance.value=0;this.listBox._addItems();this.listBox.autoHeight=false;this.listBox.height=this.dropDownHeight;this.container.height(parseInt(this.dropDownHeight)+25);this.listBoxContainer.height(parseInt(this.dropDownHeight));this.listBox._arrange();this.listBox._addItems();this.listBox._renderItems()},getItems:function(){var b=this.listBox.items;return b},_setSize:function(){if(this.width!=null&&this.width.toString().indexOf("px")!=-1){this.host.width(this.width)}else{if(this.width!=undefined&&!isNaN(this.width)){this.host.width(this.width)}}if(this.height!=null&&this.height.toString().indexOf("px")!=-1){this.host.height(this.height)}else{if(this.height!=undefined&&!isNaN(this.height)){this.host.height(this.height)}}},isOpened:function(){var c=this;var b=a.data(document.body,"openedComboJQXListBox");if(this.container.css("display")!="block"){return false}if(b!=null&&b==c.listBoxContainer){return true}return false},render:function(){var b=this;var c=false;if(!this.touch){this.host.hover(function(){if(!b.disabled&&b.enableHover){c=true;b.host.addClass(b.toThemeProperty("jqx-combobox-state-hover"));b.dropdownlistArrow.addClass(b.toThemeProperty("icon-arrow-down-hover"));b.dropdownlistArrow.addClass(b.toThemeProperty("jqx-combobox-arrow-hover"))}},function(){if(!b.disabled&&b.enableHover){b.host.removeClass(b.toThemeProperty("jqx-combobox-state-hover"));b.dropdownlistArrow.removeClass(b.toThemeProperty("icon-arrow-down-hover"));b.dropdownlistArrow.removeClass(b.toThemeProperty("jqx-combobox-arrow-hover"));c=false}})}this.addHandler(this.dropdownlistArrow,"mousedown",function(e){if(!b.disabled){var d=b.container.css("display")=="block";if(d){b.hideListBox()}else{if(b.autocomplete){b._resetautocomplete()}b.showListBox()}return false}});this.addHandler(a(document),"mousedown",b.closeOpenedListBox);this.addHandler(this.host,"keydown",function(e){var d=b.container.css("display")=="block";if(e.keyCode=="13"){b.hideListBox()}if(d&&!b.disabled){return b.listBox._handleKeyDown(e)}});this.addHandler(this.listBoxContainer,"select",function(d){if(!b.disabled){b.renderSelection(d.args.type);if(d.args.type=="mouse"){b.hideListBox()}}});this.addHandler(this.listBox.content,"click",function(d){if(!b.disabled){b.renderSelection("mouse");b.hideListBox()}})},removeHandlers:function(){var b=this;this.removeHandler(this.dropdownlistWrapper,"mousedown");this.removeHandler(this.host,"keydown");this.host.unbind("hover")},getItem:function(b){var c=this.listBox.getItem(b);return c},renderSelection:function(g){if(g==undefined||g=="none"){return}if(this.listBox==null){return}var h=this.listBox.visibleItems[this.listBox.selectedIndex];this.selectedIndex=this.listBox.selectedIndex;if(h==null){return}var f=a("<span></span>");f.appendTo(a(document.body));f.addClass(this.toThemeProperty("jqx-listitem-state-normal"));if(h.label){f.html(h.label)}else{if(h.value){f.html(h.value)}else{if(h.title){f.html(h.title)}else{f.html("jqxItem")}}}var i=this.dropdownlistContent.css("font-size");var b=this.dropdownlistContent.css("font-family");var e=this.dropdownlistContent.css("padding-top");var c=this.dropdownlistContent.css("padding-bottom");f.css("font-size",i);f.css("font-family",b);f.css("padding-top",e);f.css("padding-bottom",c);var d=f.outerHeight();f.remove();f.removeClass();this.input.val(f[0].innerHTML)},clearSelection:function(b){this.listBox.clearSelection()},unselectIndex:function(b,c){if(isNaN(b)){return}this.listBox.unselectIndex(b,c);this.renderSelection()},selectIndex:function(b,d,e,c){this.listBox.selectIndex(b,d,e,c);this.renderSelection();this.selectedIndex=b},insertAt:function(c,b){if(c==null){return}this.listBox.insertAt(c,b)},removeAt:function(b){this.listBox.removeAt(b)},ensureVisible:function(b){this.listBox.ensureVisible(b)},disableAt:function(b){this.listBox.disableAt(b)},enableAt:function(b){this.listBox.enableAt(b)},_findPos:function(c){while(c&&(c.type=="hidden"||c.nodeType!=1||a.expr.filters.hidden(c))){c=c.nextSibling}var b=a(c).offset();return[b.left,b.top]},testOffset:function(d,h,f){var g=d.outerWidth();var c=d.outerHeight();var e=document.documentElement.clientWidth+a(window).scrollLeft();var b=document.documentElement.clientHeight+a(window).scrollTop();h.left-=0;h.left-=0;h.top-=0;h.left-=Math.min(h.left,(h.left+g>e&&e>g)?Math.abs(h.left+g-e):0);h.top-=Math.min(h.top,(h.top+c>b&&b>c)?Math.abs(c+f):0);return h},showListBox:function(){var l=this;var b=this.listBoxContainer;var g=this.listBox;var i=a(window).scrollTop();var e=a(window).scrollLeft();var h=parseInt(this._findPos(this.host[0])[1])+parseInt(this.host.outerHeight())+"px";var d=parseInt(this.host.offset().left)+"px";if(a.browser.mozilla){var d=parseInt(this.host.offset().left)+1+"px"}var k=a.jqx.mobile.isSafariMobileBrowser();if(k!=null&&k){h=parseInt(h)-i+"px";d=parseInt(d)-e+"px"}this.host.addClass(this.toThemeProperty("jqx-combobox-state-selected"));this.dropdownlistArrow.addClass(this.toThemeProperty("icon-arrow-down-selected"));this.dropdownlistArrow.addClass(this.toThemeProperty("jqx-combobox-arrow-selected"));this.container.css("left",d);this.container.css("top",h);g._arrange();var c=true;if(this.enableBrowserBoundsDetection){var f=this.testOffset(b,{left:parseInt(this.container.css("left")),top:parseInt(h)},parseInt(this.host.outerHeight()));this.container.css("top",f.top)}if(this.animationType=="none"){this.container.css("display","block");a.data(document.body,"openedComboJQXListBoxParent",l);a.data(document.body,"openedComboJQXListBox",b)}else{this.container.css("display","block");var j=b.outerHeight();b.stop();b.css("margin-top",-j);b.animate({"margin-top":0},this.showDelay,function(){a.data(document.body,"openedComboJQXListBoxParent",l);a.data(document.body,"openedComboJQXListBox",b)})}this._raiseEvent("0",g)},hideListBox:function(){var d=this.listBoxContainer;var e=this.listBox;var c=this.container;if(this.container.css("display")=="none"){return}if(a.data(document.body,"openedComboJQXListBox")==null){return}a.data(document.body,"openedComboJQXListBox",null);if(this.animationType=="none"){this.container.css("display","none")}else{var b=d.outerHeight();d.css("margin-top",0);d.stop();d.animate({"margin-top":-b},this.hideDelay,function(){c.css("display","none")})}this.host.removeClass(this.toThemeProperty("jqx-combobox-state-selected"));this.dropdownlistArrow.removeClass(this.toThemeProperty("icon-arrow-down-selected"));this.dropdownlistArrow.removeClass(this.toThemeProperty("jqx-combobox-arrow-selected"));this._raiseEvent("1",e)},closeOpenedListBox:function(f){var d=this;var b=a(f.target);var c=a.data(document.body,"openedComboJQXListBox");if(c==null){return}var g=a.data(document.body,"openedComboJQXListBoxParent");if(f.target!=null&&f.target.className){if(f.target.className.indexOf("jqx-combobox-input")!=-1){return false}}var h=false;a.each(b.parents(),function(){if(this.className!=undefined&&this.className.indexOf("jqx-listbox")!=-1){h=true;return false}});if(c!=null&&!h){if(c.length>0){var e=a.data(document.body,"openedComboJQXListBoxParent");e.hideListBox()}}},loadFromSelect:function(b){this.listBox.loadFromSelect(b)},refresh:function(){this._arrange();this.renderSelection("mouse")},_arrange:function(){var f=parseInt(this.host.width());var b=parseInt(this.host.height());var e=this.arrowSize;var d=this.arrowSize;var h=1;var c=f-d-1*h;if(c>0){this.dropdownlistContent.width(c+"px")}this.dropdownlistContent.height(b);this.dropdownlistContent.css("left",0);this.dropdownlistContent.css("top",0);this.dropdownlistArrow.width(d);this.dropdownlistArrow.height(b);this.input.css("width","100%");this.input.addClass(this.toThemeProperty("jqx-rc-all"));var g=parseInt(b)/2-parseInt(this.input.height())/2;if(g>0){this.input.css("margin-top",g)}},destroy:function(){this.listBoxContainer.remove();this.host.removeClass();this.removeHandler(a(document),"mousedown",self.closeOpenedListBox)},_raiseEvent:function(f,c){if(c==undefined){c={owner:null}}var d=this.events[f];args=c;args.owner=this;var e=new jQuery.Event(d);e.owner=this;if(f==2||f==3||f==4){e.args=c}var b=this.host.trigger(e);return b},propertyChangedHandler:function(b,c,e,d){if(this.isInitialized==undefined||this.isInitialized==false){return}if(c=="source"){this.listBoxContainer.jqxListBox({source:this.source})}if(c=="autocomplete"){b._resetautocomplete()}if(c=="theme"&&d!=null){this.listBoxContainer.jqxListBox({theme:d})}if(c=="width"||c=="height"){this._setSize()}if(c=="selectedIndex"){this.listBox.selectIndex(d);this.renderSelection("mouse")}}})})(jQuery);